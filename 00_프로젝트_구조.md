# kb_healthcare 프로젝트 구조

## 1. 프로젝트 개요

(Version)
 - Spring Boot -> 3.3.5
 - Java 17
 - Mysql 8.0.45

`kb_healthcare`은 Spring Boot와 Gradle을 기반으로 한 멀티 모듈 프로젝트입니다. 이 프로젝트는 마이크로서비스와 유사한 아키텍처를 가지며, 다음과 같은 세 개의 주요 모듈로 구성됩니다.

- **`common`**: 여러 모듈에서 공통으로 사용되는 코드와 설정을 담고 있는 라이브러리 모듈입니다.
- **`authserver`**: 사용자 인증 및 토큰 발급을 담당하는 OAuth2 인증 서버입니다.
- **`record`**: `authserver`에서 발급된 토큰으로 보호되는 API를 제공하는 리소스 서버입니다.

## 2. 모듈 관계도

아래 다이어그램은 `kb_healthcare` 프로젝트의 세 가지 주요 모듈 간의 관계를 시각적으로 보여줍니다.

```
+-------------------------------------------------+
|                                                 |
|              kb_healthcare                      |
|                  (Root Project)                 |
|                                                 |
+-------------------------------------------------+
                         |
                         |  (includes)
                         |
           +-------------+-------------+
           |             |             |
           ▼             ▼             ▼
+----------------+ +----------------+ +----------------+
|                | |                | |                |
|   authserver   | |     record     | |     common     |
| (Application)  | | (Application)  | |   (Library)    |
|                | |                | |                |
+----------------+ +----------------+ +----------------+
         |                 |                 ^
         | (depends on)    | (depends on)    |
         +-----------------------------------+
                           |
```

- **`authserver`** 와 **`record`** 모듈은 모두 **`common`** 모듈에 의존합니다. 이는 `common` 모듈에 정의된 공통 엔티티, 리포지토리, 유틸리티 등을 `authserver`와 `record`에서 사용할 수 있음을 의미합니다.

## 3. 모듈별 상세 설명

### 3.1 `common` 모듈

- **설명**: `authserver`와 `record` 모듈에서 공통으로 사용되는 코드와 설정을 포함하는 라이브러리 모듈입니다.
- **주요 기능**:
    - 공통 유틸리티 클래스
    - 데이터베이스 엔티티 및 JPA 리포지토리
    - 공통 DTO (Data Transfer Objects)
- **주요 기술 스택**:
    - `org.springframework.boot:spring-boot-starter-web`
    - `org.springframework.boot:spring-boot-starter-data-jpa`
    - `com.querydsl:querydsl-jpa`: Type-safe한 데이터베이스 쿼리를 위한 라이브러리
- **빌드 설정**: `bootJar`가 비활성화되고 `jar`가 활성화되어 있어, 단독으로 실행되지 않고 다른 모듈에 라이브러리로 포함됩니다.

### 3.2 `authserver` 모듈

- **설명**: OAuth2 인증 서버로서, 사용자 인증 및 API 접근을 위한 토큰(Access Token, Refresh Token)을 발급하는 역할을 합니다.
- **주요 기능**:
    - 사용자 로그인 및 인증 처리
    - OAuth2 클라이언트 관리
    - JWT 기반 토큰 발급 및 검증
- **주요 기술 스택**:
    - `implementation project(':common')`: `common` 모듈에 의존합니다.
    - `org.springframework.boot:spring-boot-starter-oauth2-authorization-server`: Spring Security의 OAuth2 인증 서버 기능
    - `org.springframework.boot:spring-boot-starter-security`: Spring Security 기반의 인증 및 권한 관리
    - `com.mysql:mysql-connector-j`: MySQL 데이터베이스 드라이버
- **빌드 설정**: `bootJar`가 활성화되어 있어, 단독으로 실행 가능한 Spring Boot 애플리케이션으로 빌드됩니다.

### 3.3 `record` 모듈

- **설명**: OAuth2 리소스 서버로서, `authserver`에서 발급한 토큰을 사용하여 인증된 사용자만 접근할 수 있는 API를 제공합니다.
- **주요 기능**:
    - 건강 기록 관련 API 제공 (예: 생성, 조회, 수정, 삭제)
    - `authserver`에서 발급한 토큰을 검증하여 API 접근 제어
- **주요 기술 스택**:
    - `implementation project(':common')`: `common` 모듈에 의존합니다.
    - `org.springframework.boot:spring-boot-starter-oauth2-resource-server`: Spring Security의 OAuth2 리소스 서버 기능
    - `org.springdoc:springdoc-openapi-starter-webmvc-ui`: API 문서 자동화를 위한 OpenAPI (Swagger)
    - `com.mysql:mysql-connector-j`: MySQL 데이터베이스 드라이버
- **빌드 설정**: `bootJar`가 활성화되어 있어, 단독으로 실행 가능한 Spring Boot 애플리케이션으로 빌드됩니다.

## 4. 전체 아키텍처

`kb_healthcare` 프로젝트는 인증 서버와 리소스 서버가 분리된 구조를 가지고 있습니다.

1.  사용자는 `authserver`를 통해 인증을 받고 토큰을 발급받습니다.
2.  사용자는 발급받은 토큰을 사용하여 `record` 서버의 API에 요청을 보냅니다.
3.  `record` 서버는 요청에 포함된 토큰을 검증하여 유효한 사용자인지 확인하고, 유효한 경우 요청을 처리합니다.

이러한 구조는 각 서버의 역할을 명확하게 분리하여 유지보수성과 확장성을 높이는 장점이 있습니다.

## 5. 상세 파일 트리 구조

아래는 프로젝트의 상세 파일 트리 구조입니다. 주요 패키지와 파일들을 포함하고 있습니다.

```
kb_healthcare/
├── build.gradle                    # Root build 설정
├── settings.gradle                 # 모듈 설정 (include 'common', 'authserver', 'record')
│
├── authserver/                     # 인증/인가 서버 (OAuth2 Authorization Server)
│   ├── src/main/java/
│   │   └── com/kb/healthcare/authserver/
│   │       ├── AuthserverApplication.java
│   │       ├── config/               # Spring Security, CORS 등 설정
│   │       ├── controller/           # API Endpoints
│   │       ├── service/              # 비즈니스 로직
│   │       ├── dto/                  # 데이터 전송 객체
│   │       │   ├── request/
│   │       │   └── response/
│   │       └── exception/            # 예외 처리
│   ├── src/main/resources/
│   │   └── application.yml         # authserver 애플리케이션 설정
│   └── build.gradle                # authserver 모듈 빌드 설정
│
├── common/                         # 공통 라이브러리 모듈
│   ├── src/main/java/
│   │   └── com/kb/healthcare/common/
│   │       ├── business/
│   │       │   ├── user/
│   │       │   │   ├── domain/entity/  # JPA 엔티티
│   │       │   │   │   ├── User.java
│   │       │   │   │   └── UserIdentifier.java
│   │       │   │   └── repository/     # JPA 리포지토리
│   │       │   │       ├── UserRepository.java
│   │       │   │       └── UserIdentifierRepository.java
│   │       │   └── base/
│   │       │       └── domain/entity/
│   │       │           └── BaseDateTimeEntity.java
│   │       ├── dto/
│   │       │   └── response/
│   │       │       └── ApiResponse.java
│   │       └── utils/
│   │           ├── Constant.java
│   │           └── UserEnums.java
│   └── build.gradle                  # common 모듈 빌드 설정
│
└── record/                         # 걸음수 기록 서비스 (OAuth2 Resource Server)
    ├── src/main/java/
    │   └── com/kb/healthcare/record/
    │       ├── RecordApplication.java
    │       ├── config/               # Spring Security, CORS 등 설정
    │       ├── controller/           # API Endpoints
    │       ├── service/              # 비즈니스 로직
    │       └── dto/                  # 데이터 전송 객체
    ├── src/main/resources/
    │   └── application.yml         # record 애플리케이션 설정
    └── build.gradle                # record 모듈 빌드 설정
```
